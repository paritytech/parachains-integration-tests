---
settings:
  chains:
    relay_chain: &relay_chain
      wsPort: 9900
    reserve_parachain: &reserve_parachain
      wsPort: 9910
      paraId: &rp_id 1000
    trappist_parachain: &trappist_parachain
      wsPort: 9920
      paraId: &tp_id 2000
    base_parachain: &base_parachain
      wsPort: 9930
      paraId: &bp_id 3000
  variables:
    common:
      amount_to_send: &amount_to_send 10000000000000
      require_weight_at_most: &weight_at_most 1000000000
    chains:
      relay_chain:
        signer: &rc_signer //Alice
        trappist_parachain_dest_routed: &tp_dest_routed { v1: { parents: 1, interior: { x1: { parachain: *tp_id } }}}
      reserve_parachain:
        signer: &rp_signer //Alice
        wallet: &rp_wallet HNZata7iMYWmk5RvZRTiAsSDhV8366zq2YGb3tLH5Upf74F
        bob_signer: &rp_bob_signer //Bob
        bob_wallet: &rp_bob_wallet FoQJpPyadYccjavVdTWxpxU7rUEaYhfLCPwXgkfD6Zat9QP
        asset_id: &reserve_asset_id 1
        asset_pallet_id: &reserve_asset_pallet_id 50
        asset_min_balance: &reserve_assets_min_balance 1
        asset_decimals: &asset_decimals 1
        asset_multi_location: &reserve_asset_multi_location {
          parents: 1,
          interior: {
            X3: [
              {
                Parachain: *rp_id
              },
              {
                PalletInstance: *reserve_asset_pallet_id
              },
              {
                GeneralIndex: *reserve_asset_id
              }
            ]
          }
        }
      trappist_parachain:
        signer: &tp_signer //Alice
        wallet: &tp_wallet 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
        bob_wallet: &tp_bob_wallet 5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty
        asset_id: &trappist_asset_id 100 # different from reserve_asset_id, so we can test pallet-assets-registry
        asset_min_balance: &trappist_assets_min_balance 1
        sovereign_account: &tp_sovereign_sibl FBeL7EAeUroLWXW1yfKboiqTqVfbRBcsUKd6QqVf4kGBySS
        bob_account: &tp_bob_acc '0x8eaf04151687736326c9fea17e25fc5287613693c912909cb226aa4794f26a48'
      base_parachain:
        signer: &base_signer //Alice
        wallet: &base_wallet 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
        bob_wallet: &base_bob_wallet 5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty
        asset_id: &base_asset_id 1
        asset_min_balance: &base_assets_min_balance 1
        bob_account: &tp_bob_acc '0x8eaf04151687736326c9fea17e25fc5287613693c912909cb226aa4794f26a48'
  decodedCalls:
    force_create_asset:
      chain: *reserve_parachain
      pallet: assets
      call: forceCreate
      args: [
        *reserve_asset_id,
        { id: *rp_wallet }, # owner
        true, # isSufficient
        *reserve_assets_min_balance # minBalance
      ]

tests:
  - name: HRMP
    describes:
      - name: polkadotXcm.limitedReserveTransferAssets (Asset) | Reserve Parachain -> Trappist Parachain
        its:
          - name: Assets Parachain should be able to reserve transfer an asset to Trappist Parachain
            actions:
              - extrinsics:
                  - chain: *reserve_parachain
                    signer: *rp_bob_signer
                    pallet: polkadotXcm
                    call: limitedReserveTransferAssets
                    args: [
                      *tp_dest_routed, # destination
                      { # beneficiary
                        v1: {
                          parents: 0,
                          interior: {
                            x1: {
                              AccountId32: {
                                network: null,
                                id: *tp_bob_acc
                              }
                            }
                          }
                        }
                      },
                      { # assets
                        v1: [
                          {
                            id: {
                              Concrete: {
                                parents: 0,
                                interior: {
                                  x2: [
                                    {
                                      PalletInstance: *reserve_asset_pallet_id
                                    },
                                    {
                                      GeneralIndex: *reserve_asset_id
                                    }
                                  ]
                                }
                              }
                            },
                            fun: {
                              Fungible: *amount_to_send
                            }
                          }
                        ]
                      },
                      0, # feeAssetItem
                      Unlimited # weightLimit
                    ]
                    events:
                      - name: polkadotXcm.Attempted
                        attributes:
                          - type: XcmV2TraitsOutcome
                            xcmOutcome: Complete
                            threshold: [10, 10]
                            value: 654,608,000
              - queries:
                  bob_received_asset:
                    chain: *trappist_parachain
                    pallet: assets
                    call: account
                    args: [
                      *trappist_asset_id,
                      *tp_bob_wallet
                    ]
              - asserts:
                  isSome:
                    args: [ $bob_received_asset ]
