settings:
  chains:
    relay_chain: &relay_chain
      wsPort: 8000
    assets_parachain:
      wsPort: 8001
      paraId: &ap_id 1000
      skip_block_production: true
  variables:
    common:
    chains:
      relay_chain:
        signer: &rc_signer //Alice
        wallet: &rc_wallet HNZata7iMYWmk5RvZRTiAsSDhV8366zq2YGb3tLH5Upf74F
        assets_parachain_destination: &ap_dest { v3: { 0, interior: { x1: { parachain: *ap_id }}}}
  runtimes:
    genesisHead:
      path: ../../../config/chopsticks/asset-hub-kusama/genesis-head
    validationCode:
      path: ../../../config/chopsticks/asset-hub-kusama/genesis-wasm

tests:
  - name: Init RelayChain
    its:
      - name: Onboard Parachain
        actions:
          - extrinsics:
            - chain: *relay_chain
              sudo: true
              signer: *rc_signer
              pallet: registrar
              call: forceRegister
              args: [
                *rc_wallet,
                0,
                *ap_id,
                $genesisHead,
                $validationCode,
              ]
              events:
                - name: paras.PvfCheckStarted
            - chain: *relay_chain
              signer: *rc_signer
              sudo: true
              pallet: paras
              call: addTrustedValidationCode # trigger Parathread onboarding
              args: [
                $validationCode
              ]
              events:
                - name: paras.PvfCheckAccepted
            # - chain: *relay_chain
            #   signer: *rc_signer
            #   sudo: true
            #   pallet: paras
            #   call: forceQueueAction # trigger Parathread onboarding
            #   args: [
            #     *ap_id
            #   ]
            #   events:
            #     - name: paras.ActionQueued
          - block_travels:
            - chain: *relay_chain
              count: 50 # fast forward 20 blocks to finalize Parathread onboarding
          # - time_travels:
          #   - chain: *relay_chain
          #     date: 1705088303000
          - extrinsics:
            - chain: *relay_chain
              sudo: true
              signer: *rc_signer
              pallet: slots
              call: forceLease
              args: [
                *ap_id,
                *rc_wallet,
                0,
                0,
                1000,
              ]
              events:
                - name: slots.Leased
                  result: { paraId: *ap_id }
            # - chain: *relay_chain
            #   # delay: 200000 # wait first 200 seconds to onboard parathread
            #   signer: *rc_signer
            #   pallet: slots
            #   call: triggerOnboard # trigger Parachain onboarding
            #   args: [
            #     *ap_id
            #   ]
          - block_travels:
            - chain: *relay_chain
              count: 50 # fast forward 20 blocks to finalize Parathread onboarding

          # - block_travels:
          #   - chain: *relay_chain
          #     count: 50 # fast forward 50 blocks to finalize Parachain onboarding
            # - chain: *relay_chain
            #   # delay: 200000 # wait first 200 seconds to onboard parathread
            #   signer: *rc_signer
            #   sudo: true
            #   pallet: paras
            #   call: forceQueueAction # move from Parathread to Parachain
            #   args: [
            #     *ap_id
            #   ]
            #   events:
            #     - name: paras.ActionQueued
